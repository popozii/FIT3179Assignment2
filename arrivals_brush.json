{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {
    "url": "https://raw.githubusercontent.com/popozii/FIT3179Assignment2/main/ST.INT.ARVL.csv",
    "format": {"type": "csv"}
  },
  "transform": [
    {
      "fold": [
        "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004",
        "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014",
        "2015", "2016", "2017", "2018", "2019", "2020"
      ],
      "as": ["Year", "Arrivals"]
    },
    {
      "calculate": "toDate(datum.Year + '-01-01')",
      "as": "Year_date"
    },
    {
      "calculate": "toNumber(datum.Arrivals)",
      "as": "Arrivals_num"
    },
    {
      "filter": "isValid(datum.Arrivals_num) && datum.Arrivals_num > 0"
    },
    {
      "aggregate": [
        {"op": "sum", "field": "Arrivals_num", "as": "Total_Arrivals"}
      ],
      "groupby": ["Year_date"]
    },
    {
      "calculate": "datum.Total_Arrivals / 1000000",
      "as": "Arrivals_Millions"
    }
  ],
  "vconcat": [
    {
      "width": 950,
      "height": 400,
      
      "layer": [
        {
          "mark": {
            "type": "area",
            "fill": "#dceefa",
            "fillOpacity": 0.55
          },
          "encoding": {
            "x": {
              "field": "Year_date",
              "type": "temporal",
              "title": "Year",
              "axis": {"format": "%Y", "grid": false},
              "scale": {"domain": {"param": "brush"}}
            },
            "y": {
              "field": "Arrivals_Millions",
              "type": "quantitative",
              "title": "Tourist Arrivals (Millions)",
              "axis": {"format": "~s"}
            }
          }
        },
        {
          "mark": {
            "type": "line",
            "color": "#1f4f8a",
            "strokeWidth": 3,
            "strokeOpacity": 0.95
          },
          "encoding": {
            "x": {
              "field": "Year_date",
              "type": "temporal",
              "scale": {"domain": {"param": "brush"}}
            },
            "y": {
              "field": "Arrivals_Millions",
              "type": "quantitative"
            }
          }
        },

        {
          "transform": [{"filter": "year(datum.Year_date) == 2019"}],
          "mark": {"type": "point", "filled": true, "size": 100, "color": "#2e8b57"},
          "encoding": {
            "x": {"field": "Year_date", "type": "temporal", "scale": {"domain": {"param": "brush"}}},
            "y": {"field": "Arrivals_Millions", "type": "quantitative"},
            "tooltip": [{"field": "Arrivals_Millions", "title": "2019 (Millions)", "format": ".2f"}]
          }
        },
        {
          "transform": [{"filter": "year(datum.Year_date) == 2019"}],
          "mark": {
            "type": "text",
            "align": "center",
            "dy": -18,
            "fontWeight": "bold",
            "fontSize": 12,
            "color": "#2e8b57"
          },
          "encoding": {
            "x": {"field": "Year_date", "type": "temporal", "scale": {"domain": {"param": "brush"}}},
            "y": {"field": "Arrivals_Millions", "type": "quantitative"},
            "text": {"value": "2019 — Historical peak"}
          }
        },

        {
          "transform": [{"filter": "year(datum.Year_date) == 2020"}],
          "mark": {"type": "rule", "strokeDash": [6,4], "color": "#e74c3c", "strokeWidth": 1.5},
          "encoding": {
            "x": {"field": "Year_date", "type": "temporal", "scale": {"domain": {"param": "brush"}}}
          }
        },
        {
          "transform": [{"filter": "year(datum.Year_date) == 2020"}],
          "mark": {"type": "point", "filled": true, "size": 110, "color": "#e74c3c"},
          "encoding": {
            "x": {"field": "Year_date", "type": "temporal", "scale": {"domain": {"param": "brush"}}},
            "y": {"field": "Arrivals_Millions", "type": "quantitative"},
            "tooltip": [{"field": "Arrivals_Millions", "title": "2020 (Millions)", "format": ".2f"}]
          }
        },
        {
          "transform": [{"filter": "year(datum.Year_date) == 2020"}],
          "mark": {
            "type": "text",
            "align": "left",
            "dx": 8,
            "dy": -60,
            "fontSize": 12,
            "fontWeight": "bold",
            "color": "#e74c3c"
          },
          "encoding": {
            "x": {"field": "Year_date", "type": "temporal", "scale": {"domain": {"param": "brush"}}},
            "y": {"field": "Arrivals_Millions", "type": "quantitative"},
            "text": {"value": "2020 — COVID-19 shock\nGlobal arrivals collapsed"}
          }
        },

      
        {
          "transform": [{"filter": "year(datum.Year_date) == 2008"}],
          "mark": {"type": "point", "filled": true, "size": 80, "color": "#7f8c8d", "opacity": 0.9},
          "encoding": {
            "x": {"field": "Year_date", "type": "temporal", "scale": {"domain": {"param": "brush"}}},
            "y": {"field": "Arrivals_Millions", "type": "quantitative"},
            "tooltip": [{"field": "Arrivals_Millions", "title": "2008 (Millions)", "format": ".2f"}]
          }
        },
        {
          "transform": [{"filter": "year(datum.Year_date) == 2008"}],
          "mark": {
            "type": "text",
            "align": "right",
            "dx": -8,
            "dy": -28,
            "fontSize": 11,
            "color": "#7f8c8d"
          },
          "encoding": {
            "x": {"field": "Year_date", "type": "temporal", "scale": {"domain": {"param": "brush"}}},
            "y": {"field": "Arrivals_Millions", "type": "quantitative"},
            "text": {"value": "2008 — Global financial crisis\nTravel slowdown"}
          }
        },

       
        {
          "transform": [{"filter": "year(datum.Year_date) == 2012"}],
          "mark": {
            "type": "text",
            "align": "center",
            "dy": 36,
            "fontSize": 11,
            "color": "#34495e"
          },
          "encoding": {
            "x": {"field": "Year_date", "type": "temporal", "scale": {"domain": {"param": "brush"}}},
            "y": {"field": "Arrivals_Millions", "type": "quantitative"},
            "text": {"value": "2010–2014: gradual recovery\nand growth after crisis"}
          }
        },

        {
          "transform": [{"filter": "year(datum.Year_date) == 2015"}],
          "mark": {"type": "text", "align": "left", "dx": 8, "dy": -16, "fontSize": 11, "color": "#1f4f8a"},
          "encoding": {
            "x": {"field": "Year_date", "type": "temporal", "scale": {"domain": {"param": "brush"}}},
            "y": {"field": "Arrivals_Millions", "type": "quantitative"},
            "text": {"value": "2015+: steady expansion of tourism"}
          }
        }
      ]
    },
    {
      "width": 950,
      "height": 60,
      "title": "Brush here to filter time period ↑",
      "mark": "line",
      "params": [
        {
          "name": "brush",
          "select": {
            "type": "interval",
            "encodings": ["x"],
            "mark": {"fill": "#e74c3c", "fillOpacity": 0.3, "stroke": "#e74c3c"}
          }
        }
      ],
      "encoding": {
        "x": {
          "field": "Year_date",
          "type": "temporal",
          "axis": {"title": "", "format": "%Y"}
        },
        "y": {
          "field": "Arrivals_Millions",
          "type": "quantitative",
          "axis": {"title": "", "grid": false}
        }
      }
    }
  ],
  "config": {
    "view": {"stroke": "transparent"},
    "axis": {"labelFontSize": 11, "titleFontSize": 12}
  }
}
