{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 450,
  "height": 300,
  "data": {
    "url": "https://raw.githubusercontent.com/popozii/FIT3179Assignment2/main/whc-sites-2025.csv"
  },
  "transform": [
    {"filter": "isValid(datum.region_en) && isValid(datum.category)"},
    {
      "calculate": "trim(datum.region_en)",
      "as": "region_clean"
    },
    {
      "calculate": "replace(datum.region_clean, '&', 'and')",
      "as": "region_clean"
    },
    {
      "aggregate": [{"op": "count", "as": "site_count"}],
      "groupby": ["region_clean", "category"]
    },
    {
      "joinaggregate": [
        {"op": "sum", "field": "site_count", "as": "region_total"}
      ],
      "groupby": ["region_clean"]
    },
    {
      "window": [{"op": "rank", "as": "rank"}],
      "sort": [{"field": "region_total", "order": "descending"}]
    }
  ],
  "layer": [
    {
      "mark": {
        "type": "bar",
        "cornerRadiusTopLeft": 5,
        "cornerRadiusTopRight": 5,
        "opacity": 0.9,
        "stroke": "white",
        "strokeWidth": 1.2
      },
      "encoding": {
        "y": {
          "field": "region_clean",
          "type": "nominal",
          "sort": {"field": "region_total", "order": "descending"},
          "title": null,
          "axis": {"labelLimit": 140}
        },
        "x": {
          "field": "site_count",
          "type": "quantitative",
          "title": "Number of Heritage Sites",
          "axis": {"grid": true, "gridColor": "#fef3c7"}
        },
        "color": {
          "field": "category",
          "type": "nominal",
          "title": "Heritage Type",
          "scale": {
            "domain": ["Cultural", "Natural", "Mixed"],
            "range": ["#1f77b4", "#ff7f0e", "#2ca02c"]
          },
          "legend": {
            "orient": "top",
            "direction": "horizontal",
            "columns": 3
          }
        },
        "tooltip": [
          {"field": "region_clean", "title": "Region"},
          {"field": "category", "title": "Type"},
          {"field": "site_count", "title": "Sites"},
          {"field": "region_total", "title": "Total Sites in Region"}
        ]
      }
    },
    {
      "transform": [
        {"aggregate": [{"op": "mean", "field": "site_count", "as": "avg_sites"}]}
      ],
      "mark": {
        "type": "rule",
        "color": "#e74c3c",
        "strokeDash": [4, 2],
        "strokeWidth": 2,
        "opacity": 0.8
      },
      "encoding": {"x": {"field": "avg_sites", "type": "quantitative"}}
    },
    {
      "transform": [
        {"aggregate": [{"op": "mean", "field": "site_count", "as": "avg_sites"}]}
      ],
      "mark": {
        "type": "text",
        "fontSize": 11,
        "fontWeight": "bold",
        "color": "#e74c3c",
        "align": "left",
        "dx": 5,
        "dy": -5
      },
      "encoding": {
        "x": {"field": "avg_sites", "type": "quantitative"},
        "y": {"value": "Europe and North America"},
        "text": {"value": "Global Average"}
      }
    },
    {
      "data": {
        "values": [
          {
            "x": 560,
            "y": "Europe and North America",
            "text": "Cultural heritage concentration hub"
          },
          {
            "x": 290,
            "y": "Asia and the Pacific",
            "text": "Most balanced heritage composition"
          },
          {
            "x": 130,
            "y": "Africa",
            "text": "High share of natural sites"
          }
        ]
      },
      "mark": {
        "type": "text",
        "fontSize": 11,
        "fontWeight": "bold",
        "color": "#5b3213",
        "align": "left",
        "dx": 10
      },
      "encoding": {
        "x": {"field": "x", "type": "quantitative"},
        "y": {"field": "y", "type": "nominal"},
        "text": {"field": "text", "type": "nominal"}
      }
    }
  ],
  "config": {
    "background": "#fef7ed",
    "view": {"stroke": null},
    "axis": {
      "domain": false,
      "grid": true,
      "gridColor": "#fed7aa",
      "labelColor": "#7c2d12",
      "titleColor": "#7c2d12"
    }
  }
}
